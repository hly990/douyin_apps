<view class="container">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="not-login" tt:if="{{!isLogin}}">
    <image class="login-icon" src="../../assets/icons/user-placeholder.png" mode="aspectFit"></image>
    <view class="login-tip">ç™»å½•åæŸ¥çœ‹æ‚¨çš„ä¸ªäººèµ„æ–™</view>
    <button class="login-btn" bindtap="login">ç«‹å³ç™»å½•</button>
    
    <!-- è°ƒè¯•åŒºåŸŸ -->
    <view class="debug-info" style="margin-top: 30rpx; font-size: 24rpx; color: #999; padding: 20rpx;">
      <view>ç™»å½•çŠ¶æ€æ£€æŸ¥: {{isLogin ? 'å·²ç™»å½•' : 'æœªç™»å½•'}}</view>
      <view>å…¨å±€çŠ¶æ€: {{app.globalData && app.globalData.isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•'}}</view>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ - ä¸ªäººèµ„æ–™é¡µé¢ -->
  <view class="profile-container" tt:if="{{isLogin}}">
    <!-- é¡¶éƒ¨ä¸ªäººä¿¡æ¯å±•ç¤º -->
    <view class="profile-header">
      <view class="profile-info">
        <!-- ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
        <view class="avatar-container" bindtap="editProfile">
          <image class="avatar" src="{{userInfo.avatarUrl || userInfo.avatar || '../../assets/icons/user-placeholder.png'}}" mode="aspectFill"></image>
          <view class="edit-badge">
            <text class="edit-icon">âœï¸</text>
          </view>
        </view>
        <view class="user-info">
          <view class="nickname">{{userInfo.nickname || userInfo.nickName || userInfo.username || 'ç”¨æˆ·'}}</view>
          <view class="user-id" tt:if="{{userInfo.username}}">ID: {{userInfo.username}}</view>
          <view class="bio" tt:if="{{userInfo.bio}}">{{userInfo.bio}}</view>
        </view>
      </view>
      
      <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
      <view class="action-btn">
        <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
      </view>
      
      <!-- ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="user-stats">
        <view class="stat-item">
          <view class="stat-value">{{stats.followingCount || 0}}</view>
          <view class="stat-label">å…³æ³¨</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.followerCount || 0}}</view>
          <view class="stat-label">ç²‰ä¸</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.likeCount || 0}}</view>
          <view class="stat-label">è·èµ</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.collectionsCount || 0}}</view>
          <view class="stat-label">æ”¶è—</view>
        </view>
      </view>
    </view>
    
    <!-- æ”¶è—åˆ—è¡¨æ ‡é¢˜ -->
    <view class="section-title">
      <text>æ”¶è—åˆ—è¡¨</text>
    </view>
    
    <!-- è§†é¢‘åˆ—è¡¨ -->
    <view class="video-grid" tt:if="{{videos.length > 0}}">
      <view class="video-item" 
            tt:for="{{videos}}" 
            tt:key="id" 
            bindtap="onTapVideo" 
            data-id="{{item.id}}"
            data-index="{{index}}">
        <view class="video-cover-container">
          <image class="video-cover" src="{{item.coverUrl}}" mode="aspectFill" binderror="onCoverImageError" data-index="{{index}}"></image>
          <view class="video-duration">{{item.duration ? utils.formatDuration(item.duration) : '00:00'}}</view>
          <view class="video-play-count">
            <text class="play-icon">â–¶</text>
            <text>{{utils.formatCount(item.playCount || 0)}}</text>
          </view>
        </view>
        <view class="video-title" style="font-size: 28rpx; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.3;">{{item.title || 'æ— æ ‡é¢˜è§†é¢‘'}}</view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" tt:elif="{{!loading}}">
      <image class="empty-icon" src="../../assets/icons/empty-video.png" mode="aspectFit"></image>
      <view class="empty-text">
        æš‚æ— æ”¶è—è§†é¢‘
      </view>
      <view class="empty-subtext" style="font-size: 24rpx; color: #999; margin-top: 10rpx; text-align: center;">
        æ‚¨å¯èƒ½å·²æ”¶è—è§†é¢‘ï¼Œä½†è§†é¢‘ä¿¡æ¯ä¸å®Œæ•´æˆ–å·²è¢«åˆ é™¤
      </view>
      <view class="action-hint" style="margin-top: 20rpx; font-size: 26rpx; color: #666;">
        <text>æ‚¨å¯ä»¥å°è¯•ï¼š</text>
        <view style="margin-top: 10rpx;">1. è¿”å›é¦–é¡µæµè§ˆå¹¶æ”¶è—æ›´å¤šè§†é¢‘</view>
        <view>2. åˆ·æ–°é¡µé¢é‡æ–°åŠ è½½æ”¶è—åˆ—è¡¨</view>
      </view>
      <button class="refresh-btn" 
              style="margin-top: 30rpx; background-color: #fe2c55; color: #fff; border-radius: 30rpx; font-size: 28rpx; width: 200rpx; height: 70rpx; line-height: 70rpx;"
              bindtap="refreshCollections">åˆ·æ–°åˆ—è¡¨</button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ - åªåœ¨é¡µé¢åˆå§‹åŠ è½½æ—¶æ˜¾ç¤º -->
  <view class="loading-container" tt:if="{{loading && !isLogin}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- é¡µé¢çº§TabBar -->
  <view class="page-tab-bar">
    <view class="tab-item" bindtap="navigateToIndex">
      <view class="tab-icon">ğŸ </view>
      <view class="tab-text">é¦–é¡µ</view>
    </view>
    <view class="tab-item" bindtap="navigateToRecommend">
      <view class="tab-icon">ğŸ”</view>
      <view class="tab-text">æ¨è</view>
    </view>
    <view class="tab-item active">
      <view class="tab-icon">ğŸ‘¤</view>
      <view class="tab-text">æˆ‘çš„</view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-inset-bottom"></view>
</view>

<!-- ç™»å½•ç¡®è®¤å¼¹çª— -->
<view class="modal-container" tt:if="{{showLoginModal}}">
  <view class="modal-mask"></view>
  <view class="modal-content">
    <view class="modal-title">ç™»å½•ç¡®è®¤</view>
    <view class="modal-message">ç¡®å®šè¦ç™»å½•æŠ–éŸ³å°ç¨‹åºå—ï¼Ÿ</view>
    <view class="modal-buttons">
      <button class="modal-btn modal-btn-cancel" bindtap="cancelLogin">å–æ¶ˆ</button>
      <button class="modal-btn modal-btn-confirm" bindtap="confirmLogin">ç¡®å®š</button>
    </view>
  </view>
</view>